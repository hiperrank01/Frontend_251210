<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #050508;
      --accent: #7d5fff;
      --glass: rgba(255, 255, 255, 0.08);
    }
    body {
      margin: 0; font-family: 'Pretendard', sans-serif;
      background: var(--bg); color: #fff; overflow-x: hidden;
    }
    
    /* ê¸°íšì•ˆ: ê°ê° ì§€ë„ (Navigation) */
    .nav-map {
      position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
      display: flex; gap: 10px; z-index: 100;
      background: var(--glass); backdrop-filter: blur(10px);
      padding: 10px 20px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.1);
    }
    .nav-btn {
      background: none; border: none; color: #aaa; cursor: pointer; padding: 5px 15px;
      transition: 0.3s; font-size: 0.9rem;
    }
    .nav-btn.active { color: var(--accent); font-weight: bold; }

    /* ë©”ì¸ ì „ì‹œ í™€ */
    .exhibition-hall {
      padding-top: 100px; max-width: 1200px; margin: 0 auto;
      display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px;
    }

    /* ê¸°ì–µ ì¹´ë“œ (Recall Rooms) */
    .memory-card {
      background: var(--glass); border-radius: 20px; padding: 30px;
      border: 1px solid rgba(255,255,255,0.05); transition: 0.5s;
      position: relative; overflow: hidden;
    }
    .memory-card:hover {
      transform: translateY(-10px) scale(1.02);
      border-color: var(--accent); box-shadow: 0 10px 30px rgba(125, 95, 255, 0.2);
    }
    .tag { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; color: var(--accent); }
    .title { font-size: 1.4rem; margin: 15px 0; font-weight: 700; }
    .desc { font-size: 0.9rem; color: #ccc; line-height: 1.6; height: 80px; overflow: hidden; }

    /* ê°ì • ì˜¨ë„ í‘œì‹œê¸° */
    .temp-bar {
      height: 3px; width: 100%; background: #222; margin-top: 20px; border-radius: 5px;
    }
    .temp-fill { height: 100%; border-radius: 5px; transition: 1s; }

    /* ì¸í„°ë™í‹°ë¸Œ ë‹¤ì´ì–´ë¦¬ ì¡´ */
    .diary-zone {
      margin: 100px auto; max-width: 600px; text-align: center;
      background: var(--glass); padding: 40px; border-radius: 30px;
    }
    textarea {
      width: 100%; background: rgba(0,0,0,0.3); border: 1px solid #444;
      border-radius: 15px; color: #fff; padding: 15px; margin-bottom: 20px;
    }
    .save-btn {
      background: var(--accent); color: #fff; border: none; padding: 10px 30px;
      border-radius: 20px; cursor: pointer;
    }

    #loading { text-align: center; margin-top: 200px; font-size: 1.2rem; letter-spacing: 2px; }
  </style>
</head>
<body>

  <div class="nav-map">
    <button class="nav-btn active" onclick="filterSense('all')">ì „ì²´ ì§€ë„</button>
    <button class="nav-btn" onclick="filterSense('ì‹œê°')">ì‹œê°ì˜ ìˆ²</button>
    <button class="nav-btn" onclick="filterSense('ì²­ê°')">ì†Œë¦¬ì˜ ë°©</button>
    <button class="nav-btn" onclick="filterSense('ì´‰ê°')">ì˜¤ë¸Œì íŠ¸ ì•„ì¹´ì´ë¸Œ</button>
  </div>

  <div id="loading">ê¸°ì–µì˜ ì£¼íŒŒìˆ˜ë¥¼ ë§ì¶”ëŠ” ì¤‘...</div>
  
  <main class="exhibition-hall" id="hall"></main>

  <section class="diary-zone">
    <h3>Avatar Diary Book</h3>
    <p>ì´ê³³ì— ë‹¹ì‹ ì˜ ê¸°ì–µ í•œ ì¡°ê°ì„ ë‚¨ê²¨ì£¼ì„¸ìš”.</p>
    <textarea id="diaryInput" rows="4" placeholder="ì˜¤ëŠ˜ ì „ì‹œëŠ” ì–´ë– ì…¨ë‚˜ìš”?"></textarea>
    <button class="save-btn" onclick="saveMyDiary()">ê¸°ì–µ ê¸°ë¡í•˜ê¸°</button>
  </section>

  <script>
    let allData = [];

    window.onload = () => {
      google.script.run.withSuccessHandler(data => {
        allData = data;
        renderCards(data);
        document.getElementById('loading').style.display = 'none';
      }).getMemoryData();
    };

    function renderCards(data) {
      const hall = document.getElementById('hall');
      hall.innerHTML = '';
      data.forEach(item => {
        const tempColor = item.temp > 3 ? '#ff5e57' : '#00d8d6'; // ë”°ëœ»í•¨ vs ì°¨ê°€ì›€
        const card = document.createElement('div');
        card.className = 'memory-card';
        card.dataset.sense = item.type;
        card.innerHTML = `
          <div class="tag">${item.type} | ${item.nickname}</div>
          <div class="title">${item.object || item.sound}</div>
          <div class="desc">${item.description}</div>
          <div style="font-size: 0.8rem; margin-top: 10px; color: ${item.color}">â— ${item.color}</div>
          <div class="temp-bar">
            <div class="temp-fill" style="width: ${item.temp * 20}%; background: ${tempColor}"></div>
          </div>
        `;
        // í´ë¦­ ì‹œ ì†Œë¦¬ ì¬ìƒ (ê¸°íšì•ˆì˜ Trigger Audio Zones)
        card.onclick = () => alert(`ğŸ§ ì†Œë¦¬ ê°ê° ì¬ìƒ: ${item.sound}`);
        hall.appendChild(card);
      });
    }

    function filterSense(sense) {
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      const filtered = sense === 'all' ? allData : allData.filter(d => d.type.includes(sense));
      renderCards(filtered);
    }

    function saveMyDiary() {
      const text = document.getElementById('diaryInput').value;
      if(!text) return;
      google.script.run.withSuccessHandler(msg => {
        alert(msg);
        document.getElementById('diaryInput').value = '';
      }).saveDiary(text);
    }
  </script>
</body>
</html>